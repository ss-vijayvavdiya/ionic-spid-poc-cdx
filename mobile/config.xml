<?xml version="1.0" encoding="utf-8"?>
<!--
  Cordova config for the Android app.
  We include App Links + custom scheme so login works even with changing ngrok domains.
-->
<widget id="com.smartsense.spidpoc" version="0.0.1" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">
  <name>SPID PoC</name>
  <description>SPID-style SSO PoC using Signicat sandbox</description>
  <author email="dev@example.com" href="https://example.com">SmartSense</author>

  <!-- Cordova loads index.html from the built www folder -->
  <content src="index.html" />

  <!-- Allow HTTPS requests to the backend -->
  <access origin="*" />
  <allow-intent href="https://*/*" />

  <!-- Allow the custom scheme fallback -->
  <allow-intent href="smartsense:*" />

  <!-- Recommended for deep links so the same Activity handles new intents -->
  <preference name="AndroidLaunchMode" value="singleTask" />

  <!-- Plugins -->
  <plugin name="cordova-plugin-inappbrowser" spec="^5.0.0" />
  <!-- Custom scheme deep link handler (smartsense://auth/callback) -->
  <plugin name="cordova-plugin-customurlscheme" spec="^5.0.2">
    <variable name="URL_SCHEME" value="smartsense" />
    <variable name="ANDROID_SCHEME" value="smartsense" />
    <variable name="ANDROID_HOST" value="auth" />
    <variable name="ANDROID_PATHPREFIX" value="/callback" />
  </plugin>

  <!--
    ionic-plugin-deeplinks supports both App Links (https) and custom schemes.
    IMPORTANT: __NGROK_HOST__ is replaced by the script when ngrok changes.
  -->
  <plugin name="ionic-plugin-deeplinks" spec="^1.0.20">
    <variable name="URL_SCHEME" value="smartsense" />
    <variable name="DEEPLINK_SCHEME" value="https" />
    <variable name="DEEPLINK_HOST" value="057b-14-195-76-134.ngrok-free.app" />
    <variable name="ANDROID_PATH_PREFIX" value="/auth/callback" />
  </plugin>

  <!-- Universal Links configuration used by the deeplinks plugin -->
  <universal-links>
    <host name="057b-14-195-76-134.ngrok-free.app" scheme="https">
      <path url="/auth/callback" />
    </host>
  </universal-links>

  <platform name="android">
    <!-- These SDK versions are safe defaults for modern Android dev -->
    <preference name="android-minSdkVersion" value="24" />
    <preference name="android-targetSdkVersion" value="35" />
    <preference name="android-compileSdkVersion" value="35" />
  </platform>
</widget>
